{:title "ソースコードの書き方を改めて考える"
 :tags ["アイデア"]
 :layout :post
 :toc true}

ソースコードを書いていく手順について、意外と情報がない。  
自分が経験則でやってることを改めて検討してみる。

## はじめは足場組立
まず最初にやるのは、実行される最小のコードを作ること。  
C言語のmain関数のようにエントリーポイントの場合もあるし、  
GUIアプリのようなイベントドリブンの場合は、何かしらのフック関数だったり。

やることはprintで充分。

自分の書いたコードが絶対に通る場所を手に入れることが重要。

## コードを書く前にコメントを書く
これから作りたいものを、コードではなくコメントで書いておく。

```javascript
// 名前を表示する
```

コメントを見ながら、コードにしていって、新たに必要になるものをコメントしていく。

```javascript
// TODO: 名前を変更可能にする
console.log("taro")
```

```javascript
// TODO: 引数で渡せるようにする
var name = "taro"

console.log(name)
```

## バリエーションを考える
引数や関数呼び出しが登場してくると、if文などの制御構文が登場するはず。

```javascript
function hello(name) {
    // TODO: name が空の時は代わりの文字を出す
    console.log(name)
}
```

```javascript
function hello(name) {
    if (name) {
        console.log(name)
    } else {
        console.log("nanashi")
    }
}
```

## 構造をシンプルにする
いろんな手法で構造をシンプルにする。
- if文の中が長くなるなら関数にする  
if文の中身は1，2行くらいにする。
- if-elseが多くなるならswitchを使える形にする  
if-elseif-elseの3パターンより多くなるなら検討。
- 関数自体が長くなるなら、フェーズ毎に関数抽出する  
処理フローの説明にもなる。
- for文の中が長くなるなら関数にする  
やりたい処理+カウンタ処理のパターンであるはずなので、カウンタ処理以外を関数に抽出する。
- for文をmap()に置き換える  
ただの変換処理ならmap()のほうが意図を汲みやすい（関数型プログラミング知ってる必要があるが）。
- for-ifのパターンはfilter()に置き換える  
名前のまんまなので意図を汲みやすくなる。ネストが減って快適。

## コメントを書く
関数の入出力にコメントを書く。  
どういった入力を期待しているか、どういった出力になるかを明示するため。  
契約プログラミングのやり方。

処理の中で、意図が構文に現れないモノをコメントにする。  
例えば、if文に対して条件式の説明を書くのではなく、その条件にした狙いを書く。  
「何とかを更新」のような構文見たらわかることは書かない。

## 共通化を考える
フォーカスを広い範囲に移して考える。

簡単なレベルだと、重複してる関数を消すなど（DRY原則）。

進んだレベルとして、拡張可能性の検討（SOLID原則）。  
処理を高階関数で差し込めるようにしたり、if文のべた書きをポリモフィズムに変更したり。

## あとがき
あくまで自分の進め方です。

TDDだと、「最初の足場組立」と「コメントから書く」のが、「ユニットテスト環境設定」と「ユニットテストを書く」に置き換わる。

そう考えると、悪くない進め方なのではないか。
